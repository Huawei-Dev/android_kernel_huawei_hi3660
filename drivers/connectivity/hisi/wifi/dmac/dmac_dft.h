

#ifndef __DMAC_DFT_H__
#define __DMAC_DFT_H__

#ifdef __cplusplus
#if __cplusplus
extern "C" {
#endif
#endif


/*****************************************************************************
  1 ??????????????
*****************************************************************************/
#include "oal_types.h"
#include "mac_user.h"
#include "mac_vap.h"
#include "mac_device.h"
#include "dmac_user.h"
#include "dmac_vap.h"


#undef  THIS_FILE_ID
#define THIS_FILE_ID OAM_FILE_ID_DMAC_DFT_H
/*****************************************************************************
  2 ??????
*****************************************************************************/
#ifdef _PRE_WLAN_DFT_STAT
#define  DMAC_DFT_PHY_STAT_NODE_0_BASE           0   /* phy????????0??????bit????????PHY_STA_01_EN??bit0 */
#define  DMAC_DFT_PHY_STAT_NODE_1_BASE           16  /* phy????????1??????bit????????PHY_STA_01_EN??bit16 */
#define  DMAC_DFT_PHY_STAT_NODE_2_BASE           0   /* phy????????2??????bit????????PHY_STA_23_EN??bit0 */
#define  DMAC_DFT_PHY_STAT_NODE_3_BASE           16  /* phy????????3??????bit????????PHY_STA_23_EN??bit16 */
#define  DMAC_DFT_REPORT_TO_COLLECT_TIMES        100 /* ??????????????????????(2s)??????????(20ms)?????? */
#define  DMAC_DFT_COLLECT_DBB_ENV_PARAM_TIMEOUT  20  /* ????????????????????????20ms */
#define  DMAC_DFT_REPORT_VAP_STAT_TIMEOUT        2000/* ????vap???????????????????? */
#define  DMAC_DFT_PHY_INTLAN_GAIN_NUM            8   /* ????LNA???????? */
#define  DMAC_DFT_PHY_VGA_GAIN_NUM               32  /* VGA???????? */
#define  DMAC_DFT_VAP_STAT_RATE_TO_KBPS          250 /* ??????????kbps??????????????????????(2s)??????1000??????8(B/b) */
#define  DMAC_DFT_MAC_CHAN_STAT_PERIOD           20000 /* MAC??????????????????????????20000us(20ms) */
#define  DMAC_DFT_PHY_CHAN_MEASUREMENT_PERIOD    10  /* PHY????????????????????????????10ms */

#define  DMAC_DFT_MGMT_STAT_INCR(_member)     ((_member)++)
#define  DMAC_DFT_AP_BEACON_MISS_MAX_NUM(_idx, _val, _pul_val)  do {   \
         *_pul_val = ((0xFF << ((_idx) << 3)) & (_val)) >> ((_idx) << 3);  \
         }while(0)

#define  DMAC_DFT_REG_OTA_LEN              1024 /* ??????OTA?????????????? */
#endif



/*****************************************************************************
  3 ????????
*****************************************************************************/


/*****************************************************************************
  4 ????????????
*****************************************************************************/


/*****************************************************************************
  5 ??????????
*****************************************************************************/


/*****************************************************************************
  6 ????????
*****************************************************************************/


/*****************************************************************************
  7 STRUCT????
*****************************************************************************/


/*****************************************************************************
  8 UNION????
*****************************************************************************/


/*****************************************************************************
  9 OTHERS????
*****************************************************************************/


/*****************************************************************************
  10 ????????
*****************************************************************************/
#ifdef _PRE_WLAN_DFT_STAT

#if (_PRE_MULTI_CORE_MODE_OFFLOAD_DMAC == _PRE_MULTI_CORE_MODE)
/* OTA????????????????????(????????????vap??user??????????)???????????????????????????????????????? */

/*****************************************************************************
  ??????  : mem_subpool_dft_stru
  ????????: ota????????????????????
*****************************************************************************/
typedef struct
{
    oal_uint8             uc_sub_pool_id;     /* ??????????id */
    oal_uint8             auc_resv[3];
    oal_uint16            us_free_cnt;        /* ?????????????????????? */
    oal_uint16            us_total_cnt;       /* ???????????????????? */
} mem_subpool_dft_stru;

/* OTA????????????????????????????????????????????????????SDT???????????????????????????????????? */
typedef struct
{
    oal_uint8                  uc_pool_id;             /* ??????????pool id */
    oal_uint8                  uc_subpool_cnt;         /* ?????????????????????????? */
    oal_uint16                 us_max_byte_len;        /* ???????????????????????????? */
    oal_uint16                 us_mem_used_cnt;        /* ?????????????????? */
    oal_uint16                 us_mem_total_cnt;       /* ???????????????????????? */

    /* ?????????????? */
    mem_subpool_dft_stru       ast_subpool_table[WLAN_MEM_MAX_SUBPOOL_NUM];
}mem_pool_dft_stru;

/* OTA????????????????????????????????????????????SDT???????????????????????????????????? */
typedef struct
{
    oal_uint8                       uc_chip_id;
    oal_uint8                       uc_device_id;
    oal_uint8                       uc_mac_device_id;                           /* ????mac device id */
    hal_lpm_state_enum_uint8        uc_curr_state;                              /*????????????????????*/
    oal_uint32                      ul_core_id;

    hal_rx_dscr_queue_header_stru   ast_rx_dscr_queue[HAL_RX_QUEUE_NUM];
    hal_tx_dscr_queue_header_stru   ast_tx_dscr_queue[HAL_TX_QUEUE_NUM];

    hal_tx_dscr_queue_header_stru   ast_tx_dscr_queue_fake[HAL_TX_FAKE_QUEUE_NUM][HAL_TX_QUEUE_NUM];
} hal_device_dft_stru;

/* OTA??????????????????????????????????????????????SDT???????????????????????????????????? */
typedef struct
{
    dmac_tid_stru                      ast_tx_tid_queue[WLAN_TID_MAX_NUM]; /* ????tid???????? */

#ifdef _PRE_WLAN_FEATURE_UAPSD
    dmac_user_uapsd_stru               st_uapsd_stru;                      /* ??????U-APSD????????*/
#endif
}dmac_user_queue_info_dft_stru;

/* OTA??????dmac vap??????????????????????????????SDT???????????????????????????????????? */
typedef struct
{
    /* ??????????????mac_vap_stru?????????? */
    oal_uint8                        uc_vap_id;                                      /* vap ID   *//* ?????????????? */
    oal_uint8                        uc_device_id;                                   /* ????ID   */
    oal_uint8                        uc_chip_id;                                     /* chip ID  */
    wlan_vap_mode_enum_uint8         en_vap_mode;                                    /* vap????  */
    oal_uint32                       ul_core_id;
    oal_uint8                        auc_bssid[WLAN_MAC_ADDR_LEN];                   /* BSSID????MAC??????MAC??????mib????auc_dot11StationID  */
    mac_vap_state_enum_uint8         en_vap_state;                                   /* VAP???? */
    wlan_protocol_enum_uint8         en_protocol;                                    /* ?????????????? */
    mac_channel_stru                 st_channel;                                     /* vap?????????? */
    oal_uint8                        bit_has_user_bw_limit   :   1;                  /* ??vap????????user???? */
    oal_uint8                        bit_vap_bw_limit        :   1;                  /* ??vap?????????? */
    oal_uint8                        bit_resv                :   6;
    oal_uint8                        uc_tx_power;                                    /* ????????, ????dBm */
    wlan_p2p_mode_enum_uint8         en_p2p_mode;                                    /* 0:??P2P????; 1:P2P_GO; 2:P2P_Device; 3:P2P_CL */
    oal_uint8                        uc_p2p_gocl_hal_vap_id;                         /* p2p go / cl??hal vap id */
    oal_uint16                       us_user_nums;                                   /* VAP?????????????????? */
    oal_uint16                       us_multi_user_idx;                              /* ????????ID */
    mac_cap_flag_stru                st_cap_flag;
    mac_protection_stru              st_protection;                                  /* ?????????????? */

    /* ??????????????dmac_vap_stru?????????? */
    dmac_vap_linkloss_stru           st_linkloss_info;                                  /* linkloss???????????? */
    hal_tx_txop_alg_stru             st_tx_alg;                                         /* ?????????????????? */
    hal_tx_txop_alg_stru             st_tx_data_mcast;                                  /* ?????????????? */
    hal_tx_txop_alg_stru             st_tx_data_bcast;                                  /* ??????????????*/
    hal_tx_txop_alg_stru             ast_tx_mgmt_ucast[WLAN_BAND_BUTT];                 /* ??????????????*/
    hal_tx_txop_alg_stru             ast_tx_mgmt_bmcast[WLAN_BAND_BUTT];                /* ????????????????????*/

    oal_uint8                        uc_ps_user_num;                                    /* ??????????????????????????AP???????? */
    oal_uint8                        uc_dtim_count;
    oal_uint8                        uc_uapsd_max_depth;                                /* U-APSD??????????????????*/
    oal_uint8                        uc_resv;
}dmac_vap_dft_stru;

/* OTA??????dmac user??????????????????????????????SDT???????????????????????????????????? */
typedef struct
{
    /* ??????????????mac_user_stru?????????? */
    oal_uint8                               auc_user_mac_addr[WLAN_MAC_ADDR_LEN];   /* user??????MAC???? */
    oal_uint16                              us_assoc_id;                            /* user????????????????; user??STA??????????????????????AID????????????????????????1~32(??????????????1~2007)*/
    oal_bool_enum_uint8                     en_is_multi_user;
    oal_uint8                               uc_vap_id;                              /* vap ID */
    oal_uint8                               uc_device_id;                           /* ????ID */
    oal_uint8                               uc_chip_id;                             /* ????ID */
    wlan_protocol_enum_uint8                en_protocol_mode;                       /* ???????????? */
    wlan_protocol_enum_uint8                en_avail_protocol_mode;                 /* ??????VAP????????????, ?????????? */
    wlan_protocol_enum_uint8                en_cur_protocol_mode;                   /* ????????en_avail_protocol_mode??????, ?????????????? */

    oal_uint8                               uc_avail_num_spatial_stream;            /* Tx??Rx????Nss??????,?????????? */
	oal_uint8                               uc_num_spatial_stream;                  /* ???????????????????? */
	oal_uint8                               uc_avail_bf_num_spatial_stream;         /* ??????????Beamforming?????????? */
    oal_bool_enum_uint8                     en_port_valid;                          /* 802.1X?????????????? */

    mac_rate_stru                           st_avail_op_rates;                      /* ??????VAP??????11a/b/g???????????????????? */
    mac_user_tx_param_stru                  st_user_tx_info;                        /* TX???????? */

    wlan_bw_cap_enum_uint8                  en_bandwidth_cap;                       /* ???????????????? */
    wlan_bw_cap_enum_uint8                  en_avail_bandwidth;                     /* ??????VAP????????????,?????????? */
    wlan_bw_cap_enum_uint8                  en_cur_bandwidth;                       /* ????????en_avail_bandwidth????,?????????????? */
    mac_user_asoc_state_enum_uint8          en_user_asoc_state;                     /* ???????????? */

    mac_user_cap_info_stru                  st_cap_info;                            /* user?????????????? */
    mac_user_ht_hdl_stru                    st_ht_hdl;                              /* HT capability IE?? operation IE?????????? */
    mac_vht_hdl_stru                        st_vht_hdl;                             /* VHT capability IE?? operation IE?????????? */

    mac_key_mgmt_stru                       st_key_info;

    /* ??????????????dmac_user_stru?????????? */
    hal_tx_txop_alg_stru                    st_tx_data_mcast;                   /* ????????????????????11k???? */
    hal_tx_txop_alg_stru                    st_tx_data_bcast;                   /* ??????????????, ????11k???? */

    mac_user_uapsd_status_stru              st_uapsd_status;                    /* uapsd???? */
    oal_uint8                               uc_lut_index;                       /* user????????????????????????id */
    oal_uint8                               uc_uapsd_flag;                      /* STA??U-APSD?????????????? */
    oal_uint8                               uc_max_key_index;                   /* ????ptk index */
    oal_uint8                               uc_resv;

    dmac_user_rate_info_stru                st_user_rate_info;
}dmac_user_dft_stru;

#endif

/*****************************************************************************
  8 UNION????
*****************************************************************************/


/*****************************************************************************
  9 OTHERS????
*****************************************************************************/


/*****************************************************************************
  10 ????????
*****************************************************************************/
#if (_PRE_MULTI_CORE_MODE_OFFLOAD_DMAC == _PRE_MULTI_CORE_MODE)
extern oal_void dmac_dft_report_dmac_vap_info(mac_vap_stru  *pst_mac_vap);
extern oal_void dmac_dft_report_dmac_user_info(mac_vap_stru  *pst_mac_vap);
extern oal_void dmac_dft_report_dmac_event_info(mac_vap_stru  *pst_mac_vap);
extern oal_void dmac_dft_report_dmac_memory_info(mac_vap_stru  *pst_mac_vap);
extern oal_void dmac_dft_report_mac_hardware_info(mac_vap_stru  *pst_mac_vap);
extern oal_void dmac_dft_report_dmac_queue_info(mac_vap_stru  *pst_mac_vap);

#endif

extern oal_uint32  dmac_dft_set_phy_stat_node(
                                    mac_device_stru *pst_device,
                                    oam_stats_phy_node_idx_stru *pst_phy_node_idx);
extern oal_uint32  dmac_dft_start_report_dbb_env(mac_vap_stru *pst_mac_vap);
extern oal_uint32  dmac_dft_stop_report_dbb_env(mac_vap_stru *pst_mac_vap);

extern oal_uint32  dmac_dft_start_report_vap_stat(mac_vap_stru *pst_mac_vap);
extern oal_uint32  dmac_dft_stop_report_vap_stat(mac_vap_stru *pst_mac_vap);
#if (_PRE_PRODUCT_ID == _PRE_PRODUCT_ID_HI1151)
extern oal_uint32  dmac_dft_clear_usr_queue_stat(dmac_user_stru  *pst_dmac_user);
extern oal_uint32  dmac_dft_report_usr_queue_stat(dmac_user_stru  *pst_dmac_user);
#endif
extern oal_void  dmac_dft_calcu_antenna_power(mac_device_stru *pst_macdev);
extern oal_uint32  dmac_dft_mgmt_stat_incr(
                                    mac_device_stru   *pst_mac_dev,
                                    oal_uint8   *puc_mac_hdr_addr,
                                    mac_dev_mgmt_stat_type_enum_uint8 en_type);
extern oal_uint32  dmac_dft_get_machw_stat_info(
                                    hal_to_dmac_device_stru   *pst_dev,
                                    oam_stats_machw_stat_stru *pst_machw_stat);
#ifdef _PRE_WLAN_FEATURE_STA_PM
extern oal_void dmac_mac_key_statis_info(dmac_vap_stru *pst_dmac_vap, mac_device_stru  *pst_device);
#endif
extern oal_void dmac_dft_report_all_para(dmac_vap_stru *pst_dmac_sta,oal_uint8 uc_ota_switch);
extern oal_void dmac_dft_print_mac_phy_rf(mac_device_stru *pst_mac_dev);

extern oal_void  dmac_dft_report_all_ota_state(mac_vap_stru *pst_mac_sta);

#endif

#ifdef _PRE_DEBUG_MODE

extern oal_uint32  dmac_dft_report_all_ampdu_stat(dmac_user_stru  *pst_dmac_user,
                                                   oal_uint8        uc_param);



extern oal_uint32  dmac_dft_report_ampdu_stat(dmac_tid_stru  *pst_tid,
                                                      oal_uint8      auc_macaddr[],
                                                      oal_uint8       uc_param);
#endif










#ifdef __cplusplus
    #if __cplusplus
        }
    #endif
#endif

#endif /* end of dmac_dft.h */
